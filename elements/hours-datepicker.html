<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">

<dom-module id="hours-datepicker">

    <template>
        <style is="custom-style">
            .flex-wrap {
                @apply(--layout-horizontal);
                @apply(--layout-wrap);
                width: 220px;
            }

            .key {
                padding: 9px;
                margin: 1px;
            }

            .disabled {
                color:darkgrey;
            }

            .selected {
                background-color: rgba(127, 226, 159, 0.24);
            }

            .container {
                border-top: solid 1px rgba(158, 158, 158, 0.24);
            }

            .title {
                text-align: center;
            }
        </style>

        <div>
            <div class="title">Dates</div>
            <div class="container flex-wrap">
                <template is="dom-repeat" items="{{dates}}">
                        <div on-tap="_handleDates" class="key">{{item}}</div>
                </template>
            </div>
        </div>

    </template>

    <script>
        Polymer({
            is: 'hours-datepicker',
            ready: function () {
                this.dates = ['01', '02', '03', '04', '05', '06', '07', '08', '09', '10', '11', '12', '13', '14', '15',
                    '16', '17', '18', '19', '20', '21', '22', '23', '24', '25', '26', '27', '28', '29', '30', '31'];
                this.selectedDate = null;
            },
            properties: {
                day: String,
                disabledDays:{
                    type: Array,
                    value: [],
                    observer: '_disabledDaysChanges'
                }
            },
            selectNextDay: function(day) {
                if(this.selectedDate) {
                    this.selectedDate.classList.remove('selected')
                }

                var listElem = this.getElementsByClassName('key');
                var lastDateFound = day == '00' ? true : false;
                for(var i=0; i<listElem.length; i++) {
                    var date = listElem[i];
                    if(!lastDateFound) {
                        if(date.innerText == day) {
                            lastDateFound = true;
                        }
                    }
                    else {
                        if(!this._Disabled(date.innerText)) {
                            this.selectedDate = date;
                            this.selectedDate.classList.add('selected');
                            this.day = this.selectedDate.innerText;
                            break;
                        }
                    }
                }
            },
            _handleDates: function(e) {
                if(e.srcElement.classList.contains('disabled')) {
                    return;
                }

                if(this.selectedDate) {
                    this.selectedDate.classList.remove('selected')
                }
                this.selectedDate = e.srcElement;
                this.selectedDate.classList.add('selected');
                this.day = this.selectedDate.innerText;
            },
            _disabledDaysChanges: function(list) {
                var listElem = this.getElementsByClassName('key');
                for(var i=0; i<listElem.length; i++)
                {
                    var date = listElem[i];
                    if(this._Disabled(date.innerText)) {
                        date.classList.add('disabled');
                    }
                    else {
                        date.classList.remove('disabled');
                    }
                }
            },
            _Disabled: function(item) {
                var disabled = false;
                if(this.disabledDays && this.disabledDays.length>0) {
                    disabled = this.disabledDays.some(function(day) {
                       return (day == item);
                    });
                }
                return disabled;
            }
        });
    </script>

</dom-module>